---
import MainLayout from '../../layouts/main.astro';
import { getManga } from '../../services/Manganato/manganato';
import type { MangaRead } from '../../services/Manganato/manganatoTypes';
// import { Comments } from '../../components/Widgets/Comments/Comments'
import { MangaDetails } from '../../components/Widgets/MangaDetails/MangaDetails'
import { Cache } from '../../database/Cache/cache'


async function getData(): Promise<MangaRead | null> {
	const { slug } = Astro.params;

	if (!slug) return null

	const cache = new Cache()
	const cacheID = `manga:slug-${slug}` 
	const cacheData = await cache.hget(cacheID)	

	if (cacheData != null) {
		return cacheData
	}

	const manga = await getManga(slug)

	if (!manga) return null 

	cache.hset(cacheID, manga)

	return manga
}

const manga = await getData()
---

<MainLayout title={ !manga ? "Not found" : manga.title } >	
	<MangaDetails manga={manga} />
</MainLayout>
