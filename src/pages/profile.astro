---
import MainLayout from '../layouts/main.astro';
import { getMangas } from '../services/Manganato/manganato';
import { ProfileDetails } from '../components/Widgets/ProfileDetails/ProfileDetails'
import { UserListCon } from '../components/Widgets/UserListCon/UserListCon'
import { getUser } from '../database/Sequel/userDatabase'
import '../styles/pages/profile.scss';
import { getProfileData } from '../services/MangaRealm.api/api';

const cookies = Astro.cookies
const authToken = cookies.get("auth_token")?.value
const rawUserData = cookies.get("user_data")?.value

//! checks if the authToken and rawUserData from cookies is valid 
// if (!authToken || !rawUserData) { 
// return Astro.redirect("/")
// }

const urlPath = Astro.url.toString()
// const { email } = JSON.parse(rawUserData)
const email = "demykunta@gmail.com"
const profileData = await getProfileData({ email, auth_token: "auth_token" })
console.log({ profileData })
if (!profileData) {
	return Astro.redirect("/")
}


---

<MainLayout title="Profile">
	<ProfileDetails client:load user={user} />	
	<UserListCon client:load listMangas={listMangas} urlPath={urlPath} >	
</MainLayout>
